% Enumeration, verbatim, and Kindle fix
% See README.md for documentation

% This script fixes the formatting of enumerated lists (only loaded when using tex4ebook), verbatim line breaks, and various Kindle formatting issues. Also, it allows you to add a cover for a standalone EPUB.

\Preamble{xhtml,epub3}

\Configure{verbatim}
  {\HCode{<br/>}}  % Insert line breaks
  {\csname a:sp\endcsname}  % Preserve spaces

\Configure{AddCss}{style/e-book.css}

\begin{document}
\catcode`\:=11

\ConfigureList{enumerate}
   {\EndP\HCode{<ol style="list-style-type: none; padding-left: 1em;" \a:LRdir>}%
      \PushMacro\end:itm
\global\let\end:itm=\empty}
   {\PopMacro\end:itm \global\let\end:itm \end:itm
\EndP\HCode{</li></ol>}\ShowPar}
   {\end:itm \global\def\end:itm{\EndP\Tg</li>}\HCode{<li>}}
   {}

\catcode`\:=12



% -------
% Optional, if you want to create a standalone EPUB file (and not upload it to KDP), uncomment the following three lines:

% Define the cover image in the OPF manifest
% \Configure{OpfManifest}{\HCode{<item id="cover-image" properties="cover-image" media-type="image/jpeg" href="images/cover.jpg" />}}

% Add cover reference to the OPF metadata
% \Configure{OpfMetadata}{\HCode{<meta name="cover" content="cover-image" />}}

% Force inclusion of the cover image
% \special{t4ht+@File: images/cover.jpg}
% -------

\EndPreamble